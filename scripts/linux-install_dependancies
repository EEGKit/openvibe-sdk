#!/bin/bash

## supposes to have :
##   - freeglut3-dev TODO should be removed
##   - pkg-config
##   - build-essentials
##   - subversion
##   - wget
##   - tar with gzip/bzip2

####################################
##
##  initializes some environment variables
##
####################################

ov_should_build_tree_structure_flag=false

ov_should_download_archives_flag=false

ov_should_build_openmask_flag=false
ov_should_build_expat_flag=false
ov_should_build_gtk_glib_gettext_flag=false
ov_should_build_gtk_glib_flag=false
ov_should_build_gtk_cairo_libxml_flag=false
ov_should_build_gtk_cairo_zlib_flag=false
ov_should_build_gtk_cairo_libpng_flag=false
ov_should_build_gtk_cairo_freetype_flag=false
ov_should_build_gtk_cairo_fontconfig_flag=false
ov_should_build_gtk_cairo_renderproto_flag=false
ov_should_build_gtk_cairo_libxrender_flag=false
ov_should_build_gtk_cairo_flag=false
ov_should_build_gtk_pango_flag=false
ov_should_build_gtk_atk_flag=false
ov_should_build_gtk_flag=false
ov_should_build_glade_flag=false

ov_directory=`pwd`/..
ov_wget=`which wget`
ov_tar=`which tar`
ov_svn=`which svn`
ov_pkgconfig=`which pkg-config`
ov_make=`which make`

ov_depend_folder=dependancies
ov_archives_folder=arch
ov_tmp_folder=tmp

ov_dep_expat_url=http://downloads.sourceforge.net/expat/expat-2.0.0.tar.gz
ov_dep_gtk_url=ftp://ftp.gtk.org/pub/gtk/v2.10/gtk+-2.10.12.tar.gz
ov_dep_gtk_glib_url=ftp://ftp.gtk.org/pub/glib/2.12/glib-2.12.12.tar.gz
ov_dep_gtk_glib_get_text_url=ftp://mirror.cict.fr/gnu/gettext/gettext-0.16.1.tar.gz
ov_dep_gtk_cairo_libxml_url=ftp://xmlsoft.org/libxml2/libxml2-sources-2.6.28.tar.gz
ov_dep_gtk_cairo_zlib_url=http://downloads.sourceforge.net/libpng/zlib-1.2.3.tar.gz
ov_dep_gtk_cairo_libpng_url=http://downloads.sourceforge.net/libpng/libpng-1.2.18.tar.gz
ov_dep_gtk_cairo_freetype_url=http://downloads.sourceforge.net/freetype/freetype-2.3.4.tar.gz
ov_dep_gtk_cairo_fontconfig_url=http://fontconfig.org/release/fontconfig-2.4.2.tar.gz
ov_dep_gtk_cairo_renderproto_url=http://xorg.freedesktop.org/releases/individual/proto/renderproto-0.9.2.tar.bz2
ov_dep_gtk_cairo_libxrender_url=http://xorg.freedesktop.org/archive/individual/lib/libXrender-0.9.2.tar.gz
ov_dep_gtk_cairo_url=ftp://ftp.gtk.org/pub/gtk/v2.10/dependencies/cairo-1.2.6.tar.gz
ov_dep_gtk_pango_url=ftp://ftp.gtk.org/pub/pango/1.16/pango-1.16.4.tar.gz
ov_dep_gtk_atk_url=ftp://ftp.gtk.org/pub/gtk/v2.10/dependencies/atk-1.9.1.tar.bz2
ov_dep_glade_url=http://ftp.gnome.org/pub/GNOME/sources/glade3/3.1/glade3-3.1.5.tar.gz
ov_dep_cmake_url=http://www.cmake.org/files/v2.4/cmake-2.4.6-Linux-i386.tar.gz

ov_dep_expat_archive_name=openvibe-dependancy-expat-2.0.0.tar.gz
ov_dep_gtk_archive_name=openvibe-dependancy-gtk-2.10.12.tar.gz
ov_dep_gtk_glib_archive_name=openvibe-dependancy-gtk-glib-2.12.12.tar.gz
ov_dep_gtk_glib_gettext_archive_name=openvibe-dependancy-gettext-0.16.1.tar.gz
ov_dep_gtk_cairo_libxml_archive_name=openvibe-dependancy-libxml2-sources-2.6.28.tar.gz
ov_dep_gtk_cairo_zlib_archive_name=openvibe-dependancy-zlib-1.2.3.tar.gz
ov_dep_gtk_cairo_libpng_archive_name=openvibe-dependancy-libpng-1.2.18.tar.gz
ov_dep_gtk_cairo_freetype_archive_name=openvibe-dependancy-freetype-2.3.4.tar.gz
ov_dep_gtk_cairo_fontconfig_archive_name=openvibe-dependancy-fontconfig-2.4.2.tar.gz
ov_dep_gtk_cairo_renderproto_archive_name=openvibe-dependancy-renderproto-0.9.2.tar.bz2
ov_dep_gtk_cairo_libxrender_archive_name=openvibe-dependancy-libXrender-0.9.2.tar.gz
ov_dep_gtk_cairo_archive_name=openvibe-dependancy-gtk-cairo-1.2.6.tar.gz
ov_dep_gtk_pango_archive_name=openvibe-dependancy-gtk-pango-1.16.4.tar.gz
ov_dep_gtk_atk_archive_name=openvibe-dependancy-gtk-atk-1.9.1.tar.bz2
ov_dep_glade_archive_name=openvibe-dependancy-glade3-3.1.5.tar.gz
ov_dep_cmake_archive_name=openvibe-dependancy-cmake-2.4.6.tar.gz

ov_dep_openmask_svn_url=svn://scm.gforge.inria.fr/svn/openmask/OpenMASK

####################################
##
##  initializes some env variables
##
####################################

export PKG_CONFIG_PATH=$ov_directory/$ov_depend_folder/lib/pkgconfig:$PKG_CONFIG_PATH
export LD_LIBRARY_PATH=$ov_directory/$ov_depend_folder/lib:$LD_LIBRARY_PATH:.

export PATH=$ov_directory/$ov_depend_folder/bin:$PATH
export COMPILER_PATH=$ov_directory/$ov_depend_folder/include:$COMPILER_PATH
export C_INCLUDE_PATH=$ov_directory/$ov_depend_folder/include:$C_INCLUDE_PATH
export CPLUS_INCLUDE_PATH=$ov_directory/$ov_depend_folder/include:$CPLUS_INCLUDE_PATH
export LIBRARY_PATH=$ov_directory/$ov_depend_folder/lib:$LIBRARY_PATH

####################################
##
##  creates dependancy directory
##
####################################

if [ "$ov_should_build_tree_structure_flag" == "true" ]; then
	rm -rf "$ov_directory/$ov_depend_folder"
	mkdir "$ov_directory/$ov_depend_folder"
	mkdir "$ov_directory/$ov_depend_folder/$ov_tmp_folder"
	mkdir "$ov_directory/$ov_depend_folder/$ov_archives_folder"
fi;

####################################
##
##  download necessary files
##
####################################

if [ "$ov_should_download_archives_flag" == "true" ]; then
	pushd "$ov_directory/$ov_depend_folder/$ov_archives_folder"
	$ov_wget -c -O "$ov_dep_expat_archive_name"                $ov_dep_expat_url
	$ov_wget -c -O "$ov_dep_gtk_glib_gettext_archive_name"     $ov_dep_gtk_glib_get_text_url
	$ov_wget -c -O "$ov_dep_gtk_glib_archive_name"             $ov_dep_gtk_glib_url
	$ov_wget -c -O "$ov_dep_gtk_cairo_libxml_archive_name"     $ov_dep_gtk_cairo_libxml_url
	$ov_wget -c -O "$ov_dep_gtk_cairo_zlib_archive_name"       $ov_dep_gtk_cairo_zlib_url
	$ov_wget -c -O "$ov_dep_gtk_cairo_libpng_archive_name"     $ov_dep_gtk_cairo_libpng_url
	$ov_wget -c -O "$ov_dep_gtk_cairo_freetype_archive_name"   $ov_dep_gtk_cairo_freetype_url
	$ov_wget -c -O "$ov_dep_gtk_cairo_fontconfig_archive_name" $ov_dep_gtk_cairo_fontconfig_url
	$ov_wget -c -O "$ov_dep_gtk_cairo_libxrender_archive_name" $ov_dep_gtk_cairo_libxrender_url
	$ov_wget -c -O "$ov_dep_gtk_cairo_archive_name"            $ov_dep_gtk_cairo_url
	$ov_wget -c -O "$ov_dep_gtk_pango_archive_name"            $ov_dep_gtk_pango_url
	$ov_wget -c -O "$ov_dep_gtk_atk_archive_name"              $ov_dep_gtk_atk_url
	$ov_wget -c -O "$ov_dep_gtk_archive_name"                  $ov_dep_gtk_url
	$ov_wget -c -O "$ov_dep_glade_archive_name"                $ov_dep_glade_url
	$ov_wget -c -O "$ov_dep_cmake_archive_name"                $ov_dep_cmake_url
	popd
fi;

####################################
##
##  tries to build openmask
##
####################################

if [ "$ov_should_build_openmask_flag" == "true" ]; then
	pushd "$ov_directory/$ov_depend_folder/$ov_tmp_folder"
	rm -rf *
	$ov_svn checkout "$ov_dep_openmask_svn_url"
	cd *
	./configure --prefix=$ov_directory/$ov_depend_folder --disable-scen-graph
	# if [ $? -eq 0 ]; then

	$ov_make
	$ov_make install
	popd
fi;

####################################
##
##  tries to build expat
##
####################################

if [ "$ov_should_build_expat_flag" == "true" ]; then
	pushd "$ov_directory/$ov_depend_folder/$ov_tmp_folder"
	rm -rf *
	$ov_tar xvfz "$ov_directory/$ov_depend_folder/$ov_archives_folder/$ov_dep_expat_archive_name"
	cd *
	./configure --prefix=$ov_directory/$ov_depend_folder
	$ov_make
	$ov_make install
	popd
fi;

####################################
##
##  tries to build gtk_glib_gettext
##
####################################

if [ "$ov_should_build_gtk_glib_gettext_flag" == "true" ]; then
	pushd "$ov_directory/$ov_depend_folder/$ov_tmp_folder"
	rm -rf *
	$ov_tar xvfz "$ov_directory/$ov_depend_folder/$ov_archives_folder/$ov_dep_gtk_glib_gettext_archive_name"
	cd *
	./configure --prefix=$ov_directory/$ov_depend_folder
	$ov_make
	$ov_make install
	popd
fi;

####################################
##
##  tries to build gtk_glib
##
####################################

if [ "$ov_should_build_gtk_glib_flag" == "true" ]; then
	pushd "$ov_directory/$ov_depend_folder/$ov_tmp_folder"
	rm -rf *
	$ov_tar xvfz "$ov_directory/$ov_depend_folder/$ov_archives_folder/$ov_dep_gtk_glib_archive_name"
	cd *
	./configure --prefix=$ov_directory/$ov_depend_folder
	$ov_make
	$ov_make install
	popd
fi;

####################################
##
##  tries to build gtk_cairo_libxml
##
####################################

if [ "$ov_should_build_gtk_cairo_libxml_flag" == "true" ]; then
	pushd "$ov_directory/$ov_depend_folder/$ov_tmp_folder"
	rm -rf *
	$ov_tar xvfz "$ov_directory/$ov_depend_folder/$ov_archives_folder/$ov_dep_gtk_cairo_libxml_archive_name"
	cd *
	./configure --prefix=$ov_directory/$ov_depend_folder
	$ov_make
	$ov_make install
	popd
fi;

####################################
##
##  tries to build gtk_cairo_zlib
##
####################################

if [ "$ov_should_build_gtk_cairo_zlib_flag" == "true" ]; then
	pushd "$ov_directory/$ov_depend_folder/$ov_tmp_folder"
	rm -rf *
	$ov_tar xvfz "$ov_directory/$ov_depend_folder/$ov_archives_folder/$ov_dep_gtk_cairo_zlib_archive_name"
	cd *
	./configure --prefix=$ov_directory/$ov_depend_folder
	$ov_make
	$ov_make install
	popd
fi;

####################################
##
##  tries to build gtk_cairo_libpng
##
####################################

if [ "$ov_should_build_gtk_cairo_libpng_flag" == "true" ]; then
	pushd "$ov_directory/$ov_depend_folder/$ov_tmp_folder"
	rm -rf *
	$ov_tar xvfz "$ov_directory/$ov_depend_folder/$ov_archives_folder/$ov_dep_gtk_cairo_libpng_archive_name"
	cd *
	./configure --prefix=$ov_directory/$ov_depend_folder
	$ov_make
	$ov_make install
	popd
fi;

####################################
##
##  tries to build gtk_cairo_freetype
##
####################################

if [ "$ov_should_build_gtk_cairo_freetype_flag" == "true" ]; then
	pushd "$ov_directory/$ov_depend_folder/$ov_tmp_folder"
	rm -rf *
	$ov_tar xvfz "$ov_directory/$ov_depend_folder/$ov_archives_folder/$ov_dep_gtk_cairo_freetype_archive_name"
	cd *
	./configure --prefix=$ov_directory/$ov_depend_folder
	$ov_make
	$ov_make install
	popd
fi;

####################################
##
##  tries to build gtk_cairo_fontconfig
##
####################################

if [ "$ov_should_build_gtk_cairo_fontconfig_flag" == "true" ]; then
	pushd "$ov_directory/$ov_depend_folder/$ov_tmp_folder"
	rm -rf *
	$ov_tar xvfz "$ov_directory/$ov_depend_folder/$ov_archives_folder/$ov_dep_gtk_cairo_fontconfig_archive_name"
	cd *
	./configure --prefix=$ov_directory/$ov_depend_folder
	$ov_make
	$ov_make install
	popd
fi;

####################################
##
##  tries to build gtk_cairo_renderproto
##
####################################

if [ "$ov_should_build_gtk_cairo_renderproto_flag" == "true" ]; then
	pushd "$ov_directory/$ov_depend_folder/$ov_tmp_folder"
	rm -rf *
	$ov_tar xvfj "$ov_directory/$ov_depend_folder/$ov_archives_folder/$ov_dep_gtk_cairo_renderproto_archive_name"
	cd *
	./configure --prefix=$ov_directory/$ov_depend_folder
	$ov_make
	$ov_make install
	popd
fi;

####################################
##
##  tries to build gtk_cairo_libxrender
##
####################################

if [ "$ov_should_build_gtk_cairo_libxrender_flag" == "true" ]; then
	pushd "$ov_directory/$ov_depend_folder/$ov_tmp_folder"
	rm -rf *
	$ov_tar xvfz "$ov_directory/$ov_depend_folder/$ov_archives_folder/$ov_dep_gtk_cairo_libxrender_archive_name"
	cd *
	./configure --prefix=$ov_directory/$ov_depend_folder
	$ov_make
	$ov_make install
	popd
fi;

####################################
##
##  tries to build gtk_cairo
##
####################################

if [ "$ov_should_build_gtk_cairo_flag" == "true" ]; then
	pushd "$ov_directory/$ov_depend_folder/$ov_tmp_folder"
	rm -rf *
	$ov_tar xvfz "$ov_directory/$ov_depend_folder/$ov_archives_folder/$ov_dep_gtk_cairo_archive_name"
	cd *
	./configure --prefix=$ov_directory/$ov_depend_folder
	$ov_make
	$ov_make install
	popd
fi;

####################################
##
##  tries to build gtk_pango
##
####################################

if [ "$ov_should_build_gtk_pango_flag" == "true" ]; then
	pushd "$ov_directory/$ov_depend_folder/$ov_tmp_folder"
	rm -rf *
	$ov_tar xvfz "$ov_directory/$ov_depend_folder/$ov_archives_folder/$ov_dep_gtk_pango_archive_name"
	cd *
	./configure --prefix=$ov_directory/$ov_depend_folder
	$ov_make
	$ov_make install
	popd
fi;

####################################
##
##  tries to build gtk_atk
##
####################################

if [ "$ov_should_build_gtk_atk_flag" == "true" ]; then
	pushd "$ov_directory/$ov_depend_folder/$ov_tmp_folder"
	rm -rf *
	$ov_tar xvfj "$ov_directory/$ov_depend_folder/$ov_archives_folder/$ov_dep_gtk_atk_archive_name"
	cd *
	./configure --prefix=$ov_directory/$ov_depend_folder
	$ov_make
	$ov_make install
	popd
fi;

####################################
##
##  tries to build gtk
##
####################################

if [ "$ov_should_build_gtk_flag" == "true" ]; then
	pushd "$ov_directory/$ov_depend_folder/$ov_tmp_folder"
	rm -rf *
	$ov_tar xvfz "$ov_directory/$ov_depend_folder/$ov_archives_folder/$ov_dep_gtk_archive_name"
	cd *
	./configure --prefix=$ov_directory/$ov_depend_folder --without-libtiff --without-libjpeg
	$ov_make
	$ov_make install
	popd
fi;

####################################
##
##  tries to build glade
##
####################################

if [ "$ov_should_build_glade_flag" == "true" ]; then
	pushd "$ov_directory/$ov_depend_folder/$ov_tmp_folder"
	rm -rf *
	$ov_tar xvfz "$ov_directory/$ov_depend_folder/$ov_archives_folder/$ov_dep_glade_archive_name"
	cd *
	./configure --prefix=$ov_directory/$ov_depend_folder
	$ov_make
	$ov_make install
	popd
fi;

